pipeline {
  agent any
  stages {
    stage('Maven Build') {
      steps {
      script {
        sh 'mvn clean install --file app/pom.xml'
      }
    }
  }
    stage('Veracode Pipeline Scan') {
      steps {
      script {
        sh 'curl -O https://downloads.veracode.com/securityscan/pipeline-scan-LATEST.zip'
        sh 'unzip pipeline-scan-LATEST.zip pipeline-scan.jar'
        sh 'java -jar pipeline-scan.jar --veracode_api_id "${VERACODE_API_ID}" --veracode_api_key "${VERACODE_API_KEY}" --file "app/target/verademo.war" --fail_on_severity="Very High, High" --fail_on_cwe="80"'
        }
      }
    }
  }
}
